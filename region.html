<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>해외 여행 지역 선택</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body { font-family: Arial, sans-serif; margin:0; display:flex; }
  #sidebar { width: 250px; padding: 20px; background:#f0f0f0; }
  select { width: 100%; margin-bottom: 10px; padding:5px; }
  #map { flex:1; height:100vh; }
</style>
</head>
<body>

<div id="sidebar">
  <h3>지역 선택</h3>
  <select id="continent">
    <option value="">대륙 선택</option>
  </select>
  <select id="country" disabled>
    <option value="">국가 선택</option>
  </select>
  <select id="city" disabled>
    <option value="">도시 선택</option>
  </select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const data =  {
  "아시아": {
    "한국": { lat:36.5, lng:127.5, cities: { "서울":[37.5665,126.9780], "부산":[35.1796,129.0756] } },
    "일본": { lat:36.0, lng:138.0, cities: { "도쿄":[35.6895,139.6917], "오사카":[34.6937,135.5023] } }
    // 여기에 계속 추가 가능
     ,
    "중국": { 
      lat:35.8617, 
      lng:104.1954, 
      cities: { 
        "베이징":[39.9042,116.4074], 
        "상하이":[31.2304,121.4737], 
        "광저우":[23.1291,113.2644], 
        "선전":[22.5429,114.0596] 
      } 
    },
    "북한": { 
      lat:40.3399, 
      lng:127.5101, 
      cities: { 
        "평양":[39.0392,125.7625], 
        "개성":[37.9690,126.5645], 
        "남포":[38.7370,125.4422], 
        "원산":[39.1475,127.4336] 
      } 
    },
    "몽골": { 
      lat:46.8625, 
      lng:103.8467, 
      cities: { 
        "울란바토르":[47.8864,106.9057], 
        "다르항":[49.4871,105.9280], 
        "에르덴":[47.5172,108.3281], 
        "호브드":[48.0036,91.6405] 
      } 
    },
    "대만": { 
      lat:23.6978, 
      lng:120.9605, 
      cities: { 
        "타이베이":[25.0330,121.5654], 
        "가오슝":[22.6273,120.3014], 
        "타이중":[24.1477,120.6736], 
        "타이난":[22.9997,120.2270] 
      } 
    },
    "홍콩": { 
      lat:22.3193, 
      lng:114.1694, 
      cities: { 
        "홍콩섬":[22.2855,114.1577], 
        "카오룽":[22.3193,114.1694], 
        "뉴테리토리":[22.5000,114.0000] 
      } 
    },
    "마카오": { 
      lat:22.1987, 
      lng:113.5439, 
      cities: { 
        "마카오반도":[22.1987,113.5439], 
        "타이파":[22.1490,113.5604], 
        "콜로안":[22.1067,113.5472] 
      } 
    },
    "태국": { 
      lat:15.8700, 
      lng:100.9925, 
      cities: { 
        "방콕":[13.7563,100.5018], 
        "치앙마이":[18.7883,98.9853], 
        "푸켓":[7.8804,98.3923], 
        "파타야":[12.9236,100.8825] 
      } 
    },
    "베트남": { 
      lat:14.0583, 
      lng:108.2772, 
      cities: { 
        "하노이":[21.0278,105.8342], 
        "호치민":[10.8231,106.6297], 
        "다낭":[16.0544,108.2022], 
        "하이퐁":[20.8449,106.6881] 
      } 
    }
        ,
    "캄보디아": { 
      lat:12.5657, 
      lng:104.9910, 
      cities: { 
        "프놈펜":[11.5564,104.9282], 
        "씨엠립":[13.3671,103.8448], 
        "바탐방":[13.1025,103.2030], 
        "시하누크빌":[10.6270,103.5230] 
      } 
    },
    "라오스": { 
      lat:19.8563, 
      lng:102.4955, 
      cities: { 
        "비엔티안":[17.9757,102.6331], 
        "루앙프라방":[19.8860,102.1345], 
        "사반나케트":[17.9200,102.5660], 
        "팍세":[15.1170,106.8660] 
      } 
    },
    "미얀마": { 
      lat:21.9162, 
      lng:95.955974, 
      cities: { 
        "양곤":[16.8409,96.1735], 
        "만달레이":[21.9588,96.0891], 
        "네피도":[19.7450,96.1297], 
        "바간":[21.1717,94.8585] 
      } 
    },
    "인도네시아": { 
      lat:-0.7893, 
      lng:113.9213, 
      cities: { 
        "자카르타":[-6.2088,106.8456], 
        "발리":[-8.3405,115.0920], 
        "수라바야":[-7.2575,112.7521], 
        "반둥":[-6.9147,107.6098] 
      } 
    },
    "필리핀": { 
      lat:12.8797, 
      lng:121.7740, 
      cities: { 
        "마닐라":[14.5995,120.9842], 
        "세부":[10.3157,123.8854], 
        "다바오":[7.1907,125.4553], 
        "일로일로":[10.7202,122.5621] 
      } 
    },
    "말레이시아": { 
      lat:4.2105, 
      lng:101.9758, 
      cities: { 
        "쿠알라룸푸르":[3.1390,101.6869], 
        "조호바루":[1.4927,103.7414], 
        "페낭":[5.4141,100.3288], 
        "코타키나발루":[5.9804,116.0735] 
      } 
    },
    "싱가포르": { 
      lat:1.3521, 
      lng:103.8198, 
      cities: { 
        "싱가포르":[1.3521,103.8198] 
      } 
    },
    "브루나이": { 
      lat:4.5353, 
      lng:114.7277, 
      cities: { 
        "반다르스리브가완":[4.9031,114.9398] 
      } 
    },
    "동티모르": { 
      lat:-8.8742, 
      lng:125.7275, 
      cities: { 
        "딜리":[-8.5569,125.5603] 
      } 
    },
    "인도": { 
      lat:20.5937, 
      lng:78.9629, 
      cities: { 
        "뉴델리":[28.6139,77.2090], 
        "뭄바이":[19.0760,72.8777], 
        "방갈로르":[12.9716,77.5946], 
        "첸나이":[13.0827,80.2707] 
      } 
    },
    "파키스탄": { 
      lat:30.3753, 
      lng:69.3451, 
      cities: { 
        "이슬라마바드":[33.6844,73.0479], 
        "카라치":[24.8607,67.0011], 
        "라호르":[31.5204,74.3587], 
        "페샤와르":[34.0151,71.5805] 
      } 
    }
        ,
    // 중앙아시아
    "카자흐스탄": { 
      lat:48.0196, 
      lng:66.9237, 
      cities: { 
        "누르술탄":[51.1694,71.4491], 
        "알마티":[43.2220,76.8512], 
        "셰르케르타우":[50.2781,57.1653] 
      } 
    },
    "우즈베키스탄": { 
      lat:41.3775, 
      lng:64.5853, 
      cities: { 
        "타슈켄트":[41.2995,69.2401], 
        "사마르칸트":[39.6542,66.9597], 
        "부하라":[39.7747,64.4286] 
      } 
    },
    "투르크메니스탄": { 
      lat:38.9697, 
      lng:59.5563, 
      cities: { 
        "아슈하바트":[37.9601,58.3261], 
        "투르크멘바시":[40.0337,53.0492] 
      } 
    },
    "키르기스스탄": { 
      lat:41.2044, 
      lng:74.7661, 
      cities: { 
        "비슈케크":[42.8746,74.5698], 
        "오시":[40.5139,72.8167] 
      } 
    },
    "타지키스탄": { 
      lat:38.8610, 
      lng:71.2761, 
      cities: { 
        "두샨베":[38.5598,68.7870], 
        "호르그":[37.8484,69.3631] 
      } 
    },
    // 서아시아
    "터키": { 
      lat:38.9637, 
      lng:35.2433, 
      cities: { 
        "이스탄불":[41.0082,28.9784], 
        "앙카라":[39.9334,32.8597], 
        "이즈미르":[38.4192,27.1287] 
      } 
    },
    "이란": { 
      lat:32.4279, 
      lng:53.6880, 
      cities: { 
        "테헤란":[35.6892,51.3890], 
        "이스파한":[32.6546,51.6675], 
        "쉬라즈":[29.5918,52.5836] 
      } 
    },
    "사우디아라비아": { 
      lat:23.8859, 
      lng:45.0792, 
      cities: { 
        "리야드":[24.7136,46.6753], 
        "제다":[21.4858,39.1925], 
        "담맘":[26.3927,49.9777] 
      } 
    },
    "아랍에미리트": { 
      lat:23.4241, 
      lng:53.8478, 
      cities: { 
        "두바이":[25.276987,55.296249], 
        "아부다비":[24.4539,54.3773], 
        "샤르자":[25.3573,55.4033] 
      } 
    },
    "이스라엘": { 
      lat:31.0461, 
      lng:34.8516, 
      cities: { 
        "예루살렘":[31.7683,35.2137], 
        "텔아비브":[32.0853,34.7818] 
      } 
    },
    "요르단": { 
      lat:30.5852, 
      lng:36.2384, 
      cities: { 
        "암만":[31.9454,35.9284], 
        "페트라":[30.3285,35.4444] 
      } 
    }
        ,
    "레바논": {
      lat:33.8547,
      lng:35.8623,
      cities: {
        "베이루트":[33.8938,35.5018],
        "트리폴리":[34.4367,35.8494]
      }
    },
    "시리아": {
      lat:34.8021,
      lng:38.9968,
      cities: {
        "다마스쿠스":[33.5138,36.2765],
        "알레포":[36.2021,37.1343]
      }
    },
    "이라크": {
      lat:33.2232,
      lng:43.6793,
      cities: {
        "바그다드":[33.3152,44.3661],
        "모술":[36.3396,43.1586]
      }
    },
    "쿠웨이트": {
      lat:29.3759,
      lng:47.9774,
      cities: {
        "쿠웨이트시티":[29.3759,47.9774]
      }
    },
    "바레인": {
      lat:26.0667,
      lng:50.5577,
      cities: {
        "마나마":[26.2235,50.5876]
      }
    },
    "오만": {
      lat:21.5126,
      lng:55.9233,
      cities: {
        "무스카트":[23.5859,58.4059],
        "살랄라":[17.0190,54.0899]
      }
    },
    "카타르": {
      lat:25.3548,
      lng:51.1839,
      cities: {
        "도하":[25.276987,51.520008]
      }
    },
    "예멘": {
      lat:15.5527,
      lng:48.5164,
      cities: {
        "사나":[15.3694,44.1910],
        "아덴":[12.7855,45.0187]
      }
    }
  },
   "유럽": {
    "프랑스": {
      lat:46.2276,
      lng:2.2137,
      cities: {
        "파리":[48.8566,2.3522],
        "니스":[43.7102,7.2620]
      }
    },
    "독일": {
      lat:51.1657,
      lng:10.4515,
      cities: {
        "베를린":[52.5200,13.4050],
        "뮌헨":[48.1351,11.5820]
      }
    },
    "영국": {
      lat:55.3781,
      lng:-3.4360,
      cities: {
        "런던":[51.5074,-0.1278],
        "맨체스터":[53.4808,-2.2426]
      }
    }
   , "이탈리아": { lat:41.8719, lng:12.5674, cities: { "로마":[41.9028,12.4964], "밀라노":[45.4642,9.1900] } }
, "스페인": { lat:40.4637, lng:-3.7492, cities: { "마드리드":[40.4168,-3.7038], "바르셀로나":[41.3851,2.1734] } }
, "네덜란드": { lat:52.1326, lng:5.2913, cities: { "암스테르담":[52.3676,4.9041], "로테르담":[51.9225,4.4791] } }
, "스위스": { lat:46.8182, lng:8.2275, cities: { "취리히":[47.3769,8.5417], "제네바":[46.2044,6.1432] } }
, "벨기에": { lat:50.5039, lng:4.4699, cities: { "브뤼셀":[50.8503,4.3517], "앤트워프":[51.2194,4.4025] } }
, "오스트리아": { lat:47.5162, lng:14.5501, cities: { "비엔나":[48.2082,16.3738], "그라츠":[47.0707,15.4395] } }
, "포르투갈": { lat:39.3999, lng:-8.2245, cities: { "리스본":[38.7169,-9.1392], "포르투":[41.1496,-8.611] } }
, "덴마크": { lat:56.2639, lng:9.5018, cities: { "코펜하겐":[55.6761,12.5683], "오르후스":[56.1629,10.2039] } }
, "스웨덴": { lat:60.1282, lng:18.6435, cities: { "스톡홀름":[59.3293,18.0686], "예테보리":[57.7089,11.9746] } }
, "노르웨이": { lat:60.4720, lng:8.4689, cities: { "오슬로":[59.9139,10.7522], "베르겐":[60.3913,5.3221] } }
, "핀란드": { lat:61.9241, lng:25.7482, cities: { "헬싱키":[60.1699,24.9384], "투르쿠":[60.4518,22.2666] } }
, "폴란드": { lat:51.9194, lng:19.1451, cities: { "바르샤바":[52.2297,21.0122], "크라쿠프":[50.0647,19.9450] } }
, "체코": { lat:49.8175, lng:15.4730, cities: { "프라하":[50.0755,14.4378], "브르노":[49.1951,16.6068] } }
, "헝가리": { lat:47.1625, lng:19.5033, cities: { "부다페스트":[47.4979,19.0402], "데브레첸":[47.5316,21.6273] } }
, "그리스": { lat:39.0742, lng:21.8243, cities: { "아테네":[37.9838,23.7275], "테살로니키":[40.6401,22.9444] } }
, "아일랜드": { lat:53.4129, lng:-8.2439, cities: { "더블린":[53.3331,-6.2489], "코크":[51.8985,-8.4756] } }
, "루마니아": { lat:45.9432, lng:24.9668, cities: { "부쿠레슈티":[44.4268,26.1025], "클루지나포카":[46.7712,23.6236] } }
, "불가리아": { lat:42.7339, lng:25.4858, cities: { "소피아":[42.6977,23.3219], "플로브디프":[42.1354,24.7453] } }
  },
"북미": {
  "미국": {
    lat:37.0902,
    lng:-95.7129,
    cities: {
      "뉴욕":[40.7128,-74.0060],
      "로스앤젤레스":[34.0522,-118.2437],
      "시카고":[41.8781,-87.6298]
    }
  },
  "캐나다": {
    lat:56.1304,
    lng:-106.3468,
    cities: {
      "토론토":[43.651070,-79.347015],
      "밴쿠버":[49.2827,-123.1207],
      "몬트리올":[45.5017,-73.5673]
    }
  },
  "멕시코": {
    lat:23.6345,
    lng:-102.5528,
    cities: {
      "멕시코시티":[19.4326,-99.1332],
      "과달라하라":[20.6597,-103.3496],
      "몬테레이":[25.6866,-100.3161]
    }
  },
 "쿠바": {
  lat:21.5218,
  lng:-77.7812,
  cities: {
    "아바나":[23.1136,-82.3666],
    "산티아고데쿠바":[20.0219,-75.8219]
  }
},
"자메이카": {
  lat:18.1096,
  lng:-77.2975,
  cities: {
    "킹스턴":[17.9712,-76.7920],
    "몬테고베이":[18.4719,-77.9187]
  }
},
"도미니카공화국": {
  lat:18.7357,
  lng:-70.1627,
  cities: {
    "산토도밍고":[18.4861,-69.9312],
    "푸에르토플라타":[19.7571,-70.5718]
  }
}
},
"남미": {
  "브라질": {
    lat: -14.2350,
    lng: -51.9253,
    cities: {
      "리우데자네이루": [-22.9068, -43.1729],
      "상파울루": [-23.5505, -46.6333]
    }
  },
  "아르헨티나": {
    lat: -38.4161,
    lng: -63.6167,
    cities: {
      "부에노스아이레스": [-34.6037, -58.3816],
      "코르도바": [-31.4201, -64.1888]
    }
  },
  "칠레": {
    lat: -35.6751,
    lng: -71.5430,
    cities: {
      "산티아고": [-33.4489, -70.6693],
      "발파라이소": [-33.0472, -71.6127]
    }
  },
  "페루": {
    lat: -9.189967,
    lng: -75.015152,
    cities: {
      "리마": [-12.0464, -77.0428],
      "쿠스코": [-13.5319, -71.9675]
    }
  },
  "콜롬비아": {
    lat: 4.5709,
    lng: -74.2973,
    cities: {
      "보고타": [4.7110, -74.0721],
      "메데진": [6.2442, -75.5812]
    }
  },
  "에콰도르": {
    lat: -1.8312,
    lng: -78.1834,
    cities: {
      "키토": [-0.1807, -78.4678],
      "과야킬": [-2.1894, -79.8891]
    }
  },
  "볼리비아": {
    lat: -16.2902,
    lng: -63.5887,
    cities: {
      "수크레": [-19.0196, -65.2619],
      "라파스": [-16.5000, -68.1500]
    }
  },
  "우루과이": {
    lat: -32.5228,
    lng: -55.7658,
    cities: {
      "몬테비데오": [-34.9011, -56.1645],
      "살토": [-31.3858, -57.9707]
    }
  },
  "파라과이": {
    lat: -23.4425,
    lng: -58.4438,
    cities: {
      "아순시온": [-25.2637, -57.5759],
      "시우다델에스테": [-25.5090, -54.6117]
    }
  },
  "베네수엘라": {
    lat: 6.4238,
    lng: -66.5897,
    cities: {
      "카라카스": [10.4806, -66.9036],
      "마라카이보": [10.6547, -71.6500]
    }
  }
},

"아프리카": {
  "이집트": {
    lat:26.8206,
    lng:30.8025,
    cities: { "카이로":[30.0444,31.2357], "알렉산드리아":[31.2001,29.9187] }
  },
  "남아프리카공화국": {
    lat:-30.5595,
    lng:22.9375,
    cities: { "케이프타운":[-33.9249,18.4241], "요하네스버그":[-26.2041,28.0473] }
  },
  "나이지리아": {
    lat:9.0820,
    lng:8.6753,
    cities: { "아부자":[9.0765,7.3986], "라고스":[6.5244,3.3792] }
  },
  "케냐": {
    lat:-1.2921,
    lng:36.8219,
    cities: { "나이로비":[-1.2921,36.8219], "몸바사":[-4.0435,39.6682] }
  },
  "모로코": {
    lat:31.7917,
    lng:-7.0926,
    cities: { "라바트":[34.0209,-6.8416], "카사블랑카":[33.5731,-7.5898] }
  },
  "알제리": {
    lat:28.0339,
    lng:1.6596,
    cities: { "알제":[36.7538,3.0588], "오랑":[35.6990,-0.6360] }
  },
  "튀니지": {
    lat:33.8869,
    lng:9.5375,
    cities: { "튀니스":[36.8065,10.1815], "사프엣":[36.7167,10.4167] }
  },
  "가나": {
    lat:7.9465,
    lng:-1.0232,
    cities: { "아크라":[5.6037,-0.1870], "쿠마시":[6.6885,-1.6244] }
  },
  "우간다": {
    lat:1.3733,
    lng:32.2903,
    cities: { "캄팔라":[0.3476,32.5825], "엔테베":[0.0647,32.4432] }
  },
  "에티오피아": {
    lat:9.1450,
    lng:40.4897,
    cities: { "아디스아바바":[9.0300,38.7400], "디렉": [8.9806,38.7578] }
  },
  "탄자니아": {
    lat:-6.3690,
    lng:34.8888,
    cities: { "다르에스살람":[-6.7924,39.2083], "도도마":[-6.1630,35.7516] }
  },
  "모잠비크": {
    lat:-18.6657,
    lng:35.5296,
    cities: { "마푸토":[-25.9653,32.5892], "베이라":[-19.8486,34.8516] }
  },
  "잠비아": {
    lat:-13.1339,
    lng:27.8493,
    cities: { "루사카":[-15.3875,28.3228], "리빙스턴":[-17.8419,25.8541] }
  },
  "짐바브웨": {
    lat:-19.0154,
    lng:29.1549,
    cities: { "하라레":[-17.8252,31.0335], "불라와요":[-20.1456,28.5873] }
  },
  "보츠와나": {
    lat:-22.3285,
    lng:24.6849,
    cities: { "가보로네":[-24.6545,25.9086], "프란시스타운":[-21.1702,27.4907] }
  },
  "세네갈": {
    lat:14.4974,
    lng:-14.4524,
    cities: { "다카르":[14.6928,-17.4467], "투바":[14.7833,-16.2333] }
  },
  "코트디부아르": {
    lat:7.539989,
    lng:-5.547080,
    cities: { "아비장":[5.3453,-4.0244], "야무수크로":[6.8206,-5.2761] }
  },
  "말리": {
    lat:17.5707,
    lng:-3.9962,
    cities: { "바마코":[12.6392,-8.0029], "시카소":[13.7296,-5.2576] }
  },
  "콩고민주공화국": {
    lat:-4.0383,
    lng:21.7587,
    cities: { "킨샤사":[-4.4419,15.2663], "리포르":[-2.5192,23.3962] }
  },
  "앙골라": {
    lat:-11.2027,
    lng:17.8739,
    cities: { "루안다":[-8.8390,13.2894], "로안다":[-12.9699,15.9672] }
  },
  "수단": {
    lat:12.8628,
    lng:30.2176,
    cities: { "카르툼":[15.5007,32.5599], "오무두르만":[15.6231,32.5265] }
  },
  "모리셔스": {
    lat:-20.3484,
    lng:57.5522,
    cities: { "포트루이스":[-20.1609,57.5012], "퀸타":[-20.2333,57.5000] }
  },
  "마다가스카르": {
    lat:-18.7669,
    lng:46.8691,
    cities: { "안타나나리보":[-18.8792,47.5079], "토아마시나":[-18.1496,49.4023] }
  },
  "알제리": {
    lat:28.0339,
    lng:1.6596,
    cities: { "알제":[36.7538,3.0588], "오랑":[35.6990,-0.6360] }
  }
  // 여기서 계속 아프리카 국가 추가 가능
},
"오세아니아": {
  "호주": {
    lat:-25.2744,
    lng:133.7751,
    cities: { "시드니":[-33.8688,151.2093], "멜버른":[-37.8136,144.9631] }
  },
  "뉴질랜드": {
    lat:-40.9006,
    lng:174.8860,
    cities: { "오클랜드":[-36.8485,174.7633], "웰링턴":[-41.2865,174.7762] }
  },
  "피지": {
    lat:-17.7134,
    lng:178.0650,
    cities: { "수바":[-18.1248,178.4501], "나디":[-17.7765,177.4353] }
  },
  "파푸아뉴기니": {
    lat:-6.314993,
    lng:143.95555,
    cities: { "포트모르즈비":[-9.4438,147.1803], "라에":[-6.7286,146.9971] }
  },
  "솔로몬제도": {
    lat:-9.6457,
    lng:160.1562,
    cities: { "호니아라":[-9.4333,159.9500], "길버트":[-10.2000,161.0833] }
  },
  "바누아투": {
    lat:-15.3767,
    lng:166.9592,
    cities: { "포트빌라":[-17.7333,168.3167], "사누마":[-16.7500,167.2333] }
  },
  "사모아": {
    lat:-13.7590,
    lng:-172.1046,
    cities: { "아피아":[-13.8333,-171.7667], "살레아":[-13.8500,-172.0833] }
  },
  "통가": {
    lat:-21.1790,
    lng:-175.1982,
    cities: { "누쿠알로파":[-21.1394,-175.2045], "에아":[-21.2000,-175.2167] }
  },
  "미크로네시아": {
    lat:7.4256,
    lng:150.5508,
    cities: { "파리키르":[6.9150,158.1850], "코로르":[7.3414,134.4700] }
  },
  "팔라우": {
    lat:7.5149,
    lng:134.5825,
    cities: { "코로르":[7.3333,134.4833], "겔르":[7.5000,134.6167] }
  }
  // 여기서 계속 오세아니아 국가 추가 가능
},
"남극": {
  "남극대륙": {
    lat:-82.8628,
    lng:135.0000,
    cities: { 
      "맥머도기지":[-77.8419,166.6863],
      "아문센-스콧기지":[-90.0000,0.0000],
      "로버트슨기지":[-68.1333,77.6167]
    }
  }
  // 남극은 주거 국가가 없으므로 연구기지 중심으로만 추가 가능
}


};

// 지도 초기화
const map = L.map('map').setView([20,0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

const continentSelect = document.getElementById("continent");
const countrySelect = document.getElementById("country");
const citySelect = document.getElementById("city");

let currentMarker = null;

// 대륙 옵션 채우기
Object.keys(data).forEach(cont => {
  const opt = document.createElement("option");
  opt.value = cont;
  opt.textContent = cont;
  continentSelect.appendChild(opt);
});

// 이벤트
continentSelect.addEventListener("change", ()=>{
  countrySelect.innerHTML = '<option value="">국가 선택</option>';
  citySelect.innerHTML = '<option value="">도시 선택</option>';
  countrySelect.disabled = true;
  citySelect.disabled = true;
  const cont = continentSelect.value;
  if(!cont) return;
  Object.keys(data[cont]).forEach(cn => {
    const opt = document.createElement("option");
    opt.value = cn;
    opt.textContent = cn;
    countrySelect.appendChild(opt);
  });
  countrySelect.disabled = false;

  const firstCountry = Object.values(data[cont])[0];
  map.setView([firstCountry.lat, firstCountry.lng], 3);
});

countrySelect.addEventListener("change", ()=>{
  citySelect.innerHTML = '<option value="">도시 선택</option>';
  citySelect.disabled = true;
  const cont = continentSelect.value;
  const cn = countrySelect.value;
  if(!cn) return;
  Object.keys(data[cont][cn].cities).forEach(city=>{
    const opt = document.createElement("option");
    opt.value = city;
    opt.textContent = city;
    citySelect.appendChild(opt);
  });
  citySelect.disabled = false;

  const country = data[cont][cn];
  map.setView([country.lat, country.lng], 5);
});

// === 수정된 부분: city 선택 시 getCityInfo 호출 ===
citySelect.addEventListener("change", async ()=>{
  const cont = continentSelect.value;
  const cn = countrySelect.value;
  const city = citySelect.value;
  if(currentMarker) map.removeLayer(currentMarker);
  const coords = data[cont][cn].cities[city];

  try {
    const res = await fetch("/getCityInfo", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({city: city, country: cn})
    });
    const place = await res.json();

    const popupContent = `
      <b>${place.name}, ${place.country}</b><br>
      <img src="${place.image}" alt="${place.name}" style="width:200px;height:auto;"><br>
      <p>${place.description}</p>
    `;

    currentMarker = L.marker(coords).addTo(map).bindPopup(popupContent).openPopup();
    map.setView(coords, 10);
  } catch(err) {
    console.error(err);
    currentMarker = L.marker(coords).addTo(map)
      .bindPopup(`${city}, ${cn} (정보 불러오기 실패)`).openPopup();
    map.setView(coords, 10);
  }
});
</script>
</body>
</html>
